<script>
    const DesignMapMessagesMixin = {
        ready: function(){
            this.snackbar = document.querySelector('plastic-snackbar');
        },
        /**
         * Show usual message.
         * @param message
         */
        showMessage: function(message,replacement,duration){
           var msg = this.i18nDomain.getMsg(message) || message;
            if(replacement) msg = this.replaceExpressions(msg,replacement);
            this.snackbar.add({text:msg,duration:duration});
        },
        /**
         * Show usual message.
         * @param message
         */
        showUndoMessage: function(message,replacement,duration){
            var msg = this.i18nDomain.getMsg(message) || message;
            if(replacement) msg = this.replaceExpressions(msg,replacement);
            this.snackbar.add({text:msg,duration:duration,undo:true});
        },
        /**
         * Show error message.
         * @param message
         */
        showErrorMessage: function(message,replacement,duration){
            var msg = this.i18nDomain.getMsg(message) || message;
            if(replacement) msg = this.replaceExpressions(msg,replacement);
            this.snackbar.add({text:msg,error:true,duration:duration});
        },
        /**
         * Special designmap toast function !
         */
        notify: function(message, type, replacement, sender, duration){
          var msg = this.i18nDomain.getMsg(message) || message;
          if(replacement) msg = this.replaceExpressions(msg,replacement);
          this.snackbar.add({text:msg,type: type, notify:true,sender:sender,duration:duration});
          /*this.async(function(){
            var notifier = document.querySelector('designmap-notifier');
            var notifierBounding = notifier.getBoundingClientRect();
            var toastBounding = document.querySelector('plastic-toast').getBoundingClientRect();
            this.snackbar.style.left = notifierBounding.left - (toastBounding.width/2) - 65 + 'px';
            this.snackbar.style.top = 70 + 'px';
          },0);*/
        },
        /**
         * Replace all of expressions in the sentence
         */
        replaceExpressions: function(msg,replacement,duration){
            for(var expression in replacement) {
                var value = replacement[expression];
                msg = msg.replace(expression,value);
            }
            return msg;
        },
        /**
         * Translate function can manage any codes or full phrases.
         * @param msg
         * @returns {*}
         */
        translate: function(msg,language,i18Loaded) {
          if(!msg) return msg;
          this.i18nDomain = this.i18nDomain || document.querySelector('designmap-app').$.i18nDomain;
          return !this.i18nDomain ? msg : this.i18nDomain.getMsg(msg) || msg;
        },
        /**
         * Compute language
         * @param language
         * @returns {*|string}
         * @private
         */
        _computeLanguage: function(language){
            return language || 'ru';
        },
        /**
         * Manage not successful response
         * @param response
         * @returns {*}
         */
        manageErrorResponse: function(response){
            if(response.errors) {
                // If we have array of errors
                if(response.errors instanceof Array) {
                    response.errors.forEach(function(error){
                        if(error.message) return this.showErrorMessage(error.message);
                        for(var p in error) {
                            var e = error[p];
                            if(e.message) return this.showErrorMessage(e.message);
                        }
                    }.bind(this));
                }
                // Passport info handle | Some my errors have similar view
                if(response.errors.message) return this.showErrorMessage(response.errors.message);
            }
            if(response.response && response.response.error) {
                return this.showErrorMessage(response.response.error);
            }
            if(response.message) {
                return this.showErrorMessage(response.message);
            }
        }
    }
</script>
