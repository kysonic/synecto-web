<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="../designmap-fs/designmap-fs-service.html">

<dom-module is="designmap-info">
    <template>
        <style>
            :host {
                display: block;
                height: 100%;
                white-space: nowrap;
                font-weight: 100;

                --designmap-info-color: var(--blue-darkest-color);
                --designmap-info-circle-background: var(--gray-lightenest-color);
                --designmap-info-circle-border: var(--gray-lighty-color);
                --designmap-info-label-color: var(--blue-darker-color);
                --designmap-info-folder-wrapper: var(--blue-color);
                --designmap-info-message-text: var(--gray-darkend-color);
            }

            .information {
                text-align: center;
                padding-top: 20px;
            }

            .name {
                text-align: center;
                font-size: 22px;
                font-family: var(--font-family);
                padding: 25px 0;
                color: var(--designmap-info-color);
                font-weight: 100;
                text-transform: capitalize;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 90%;
                margin: 0 auto;
            }

            .circle {
                width: 60px;
                height: 60px;
                background: var(--designmap-info-circle-background);
                color: var(--designmap-info-message-text);
                border-radius: 50%;
                border: 1px solid var(--designmap-info-circle-border);
                display: inline-block;
                margin-left: 5px;
                vertical-align: top;
            }

            .circle .store-icon {
                width: 30px;
                height: 30px;
                padding: 15px 0;
            }

            .circle .size {
                padding: 20px 0;
            }

            .circle:first-child {
                margin-left: 0px;
            }

            .circle .folder-wrapper {
                height: 20px;
                width: 30px;
                padding: 16px 9px;
            }

            .circle .folder-wrapper .label {
                height: 2px;
                width: 18px;
                background: var(--designmap-info-label-color);
            }

            .circle .folder-wrapper .folder {
                height: 28px;
                width: 44px;
                background: var(--designmap-info-folder-wrapper);
            }

            .circle .ext {
                color: var(--designmap-info-label-color);
                text-align: center;
                font-size: 22px;
                text-transform: uppercase;
                padding: 15px 0;
                font-weight: bold;
            }

            .info {
                padding: 5px 10px;
                text-align: center;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .info > * {
                display: inline-block;
            }

            .info .message {
                color: var(--designmap-info-message-text);

            }

            .info .title {
                font-weight: 500;
                color: var(--designmap-info-message-text);
            }

            .message {
                text-align: center;
            }

            .store-icon.designmap {
                width: 25px !important;
                height: 25px !important;
                padding: 17px 0 0 0 !important;
            }

        </style>
        <div class="information" hidden$="[[!computeInfoState(data)]]">
           <!-- <div class="circle" hidden$="[[!isFile(data)]]">
                <iron-icon class$="store-icon [[data.data.storage]]" icon="designmap:designmap"></iron-icon>
            </div>-->
            <div class="circle">
                <div class="folder-wrapper" hidden$="[[isFile(data)]]">
                    <div class="label"></div>
                    <div class="folder"></div>
                </div>
                <div class="ext" hidden$="[[!isFile(data)]]">
                    [[getExtension(data.data.name)]]
                </div>
            </div>
           <!-- <div class="circle" hidden$="[[!isFile(data)]]">
                <div class="size">[[computeFileSize(data.data.size)]]</div>
            </div>-->
            <div class="name" title="[[computeName(data)]]">[[computeName(data)]]</div>
            <!-- Information -->
            <div class="info">
                <div class="title">
                    <i18-n msgid="Path">Path</i18-n>
                    :
                </div>
                <div class="message">[[computePath(data.path)]]</div>
            </div>
            <div class="info" hidden$="[[isFile(data)]]">
                <div class="title">
                    <i18-n msgid="Children">Children</i18-n>
                    :
                </div>
                <div class="message">[[computeChildren(data)]]</div>
            </div>
            <div class="info" hidden$="[[!data.files]]">
                <div class="title">
                    <i18-n msgid="Files">Files</i18-n>
                    :
                </div>
                <div class="message">[[data.files.length]]</div>
            </div>
            <div class="info" hidden$="[[!data.data.mimeType]]">
                <div class="title">
                    <i18-n msgid="Mime type">Mime type</i18-n>
                    :
                </div>
                <div class="message">[[data.data.mimeType]]</div>
            </div>
            <div class="info" hidden$="[[!data.data.size]]">
                <div class="title">
                    <i18-n msgid="Size">Size</i18-n>
                    :
                </div>
                <div class="message">[[data.data.size]]</div>
            </div>
            <div class="info" hidden$="[[!data.data.storage]]">
                <div class="title">
                    <i18-n msgid="Storage">Storage</i18-n>
                    :
                </div>
                <div class="message">[[data.data.storage]]</div>
            </div>
        </div>
        <!-- No selected -->
        <div class="message" hidden$="[[computeInfoState(data)]]">
            <div class="information">
                <div class="circle">
                    <div class="folder-wrapper">
                        <div class="label"></div>
                        <div class="folder"></div>
                    </div>
                </div>
                <div class="name" title="[[project.name]]">[[project.name]]</div>
                <div class="info" hidden$="[[!project.created]]">
                    <div class="title">
                        <i18-n msgid="Created">Created</i18-n>
                        :
                    </div>
                    <div class="message">[[project.created]]</div>
                </div>
            </div>
        </div>
    </template>
    <script>
        var ICONS = {
            'googleDrive': 'google-drive',
            'yandexDisk': 'yandex-disk',
            'dropBox': 'dropbox',
            'designmap': 'designmap'
        };
        Polymer({
            is: 'designmap-info',
            behaviors: [
                ReduxBehavior,
                Polymer.DesignMapUtilsBehavior,
                Polymer.DesignMapFsService
            ],
            properties: {
                data: {
                    type: Object,
                    value: null
                },
                project: {
                    type: Object,
                    statePath: 'project'
                }
            },
            /**
             * State of information
             */
            computeInfoState: function (data) {
                return !!data;
            },
            /**
             * Compute store icon
             */
            computeStoreIcon: function (file) {
                if (!file || !file.data) return null;
                return 'designmap-stores:designmap' + ICONS[file.data.storage];
            },
            /**
             * Compute element name
             */
            computeName: function (element) {
                if (!element) return '';
                if (element && element.name) return element.name;
                if (element && element.data && element.data.name) return this.getElementName(element);
            },
            /**
             * Count kb mb and etc
             */
            computeFileSize: function (size) {
                if (size / 1024 > 1) return Math.round(size / 1024) + ' Mb';
                return size ? Math.round(size) + ' Kb' : 0;
            },
            /**
             * Compute path
             */
            computePath: function (path) {
                return path || '/';
            },
            /**
             * Compute folder's children
             */
            computeChildren: function (data) {
                if (!data) return 0;
                return this.findFolderByCriteria({path: this.getFullPath(data)}).length;
            },
            /**
             * Whether element is file?
             * @param element - element
             * @returns {boolean}
             */
            isFile: function (element) {
                return element ? element.type == 'file' : false;
            },
            /**
             * Get extension of the file
             */
            getExtension: function (name) {
                if (!name) return null;
                var splitter = name.split('.');
                var ext = splitter[splitter.length - 1];
                return '.' + ext;
            }
        })
    </script>
</dom-module>
