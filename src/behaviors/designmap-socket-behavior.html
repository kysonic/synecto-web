<script>
    Polymer.DesignmapSocketBehavior = {
        /**
         * Setup socket
         */
        setupSocket: function (roomId, type) {
            this.roomId = roomId;
            this.type = type;
            if (this.socket) this.socket.disconnect();
            if (!this.socket) {
                // Connect to appropriate room created specially for this project.
                this.socket = Designmap[type+'Socket'] = io.connect(Designmap.config.apiURL, {query: 'room=' + roomId});
                this.setupSocketSubscribers();
            } else {
                // Change room
                this.socket.io.opts.query = 'room=' + roomId;
                this.socket.connect();
            }
        },
        /**
         * Socket subscribers
         */
        setupSocketSubscribers: function () {
            this.socket.on('connect', function () {
                console.log('DesignMap '+this.type+' socket is connected. Room ='+this.roomId);
            }.bind(this));
            /**
             * Create file
             */
            this.socket.on('action', function (o) {
                if (o.uid == Designmap.uid) return;
                ReduxStore.dispatch(o);
            }.bind(this));
        },
        /**
         * Add custom socket subscriber
         */
        addSocketSubscriber: function(name,cb){
            this.socket.on(name,cb);
        }
    }
</script>
